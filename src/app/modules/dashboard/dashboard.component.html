<div class="container-fluid pl-5 pr-5">
  <div
    *ngIf="dataSource"
    class="table-wrapper rounded mat-elevation-z8 p-3 pl-5 pr-5"
  >
    <table
      mat-table
      [dataSource]="dataSource"
      multiTemplateDataRows
      class="w-100"
    >
      <ng-container matColumnDef="index">
        <th mat-header-cell *matHeaderCellDef>INDEX</th>
        <td mat-cell *matCellDef="let element; let i = dataIndex">
          {{ i + 1 }}
        </td>
      </ng-container>

      <ng-container
        matColumnDef="{{ column.elementPropertyName }}"
        *ngFor="
          let column of columnsToDisplay | slice: 1:columnsToDisplay.length - 1
        "
      >
        <th mat-header-cell *matHeaderCellDef>
          {{ column.romanianTranslation }}
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element[column.elementPropertyName] }}
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>STATUS</th>
        <td mat-cell *matCellDef="let element">
          <status-bar [status]="element.status"></status-bar>
        </td>
      </ng-container>

      <ng-container matColumnDef="expandedDetail">
        <td
          mat-cell
          *matCellDef="let element"
          [attr.colspan]="columnsToDisplay.length"
          [ngClass]="{
            'blue-border': this.shouldHaveBlueBorder(element),
            'no-border': dataSource.indexOf(element) === dataSource.length - 1
          }"
        >
          <div
            class="row mx-auto overflow-hidden"
            [@detailExpand]="
              element == expandedElement ? 'expanded' : 'collapsed'
            "
          >
            <div
              class="col pt-3"
              *ngFor="let column of detailsColumnsToDisplay"
            >
              <p class="details-header">{{ column.romanianTranslation }}</p>
              <p>{{ element[column.elementPropertyName] }}</p>
            </div>
            <div class="col pt-4">
              <div class="row justify-content-end mr-1">
                <edit-button></edit-button>
                <delete-button></delete-button>
              </div>
            </div>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="headerColumns"></tr>

      <tr
        mat-row
        *matRowDef="let element; columns: headerColumns"
        class="element-row"
        [ngClass]="{
          'element-row-expanded': element == expandedElement
        }"
        [class.expanded-row]="expandedElement === element"
        (click)="expandedElement = expandedElement === element ? null : element"
      ></tr>

      <tr
        mat-row
        *matRowDef="let row; columns: ['expandedDetail']"
        class="detail-row"
      ></tr>
    </table>
  </div>
  <paginator></paginator>
</div>
